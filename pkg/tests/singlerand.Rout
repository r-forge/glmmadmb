
R version 2.13.0 (2011-04-13)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i486-pc-linux-gnu (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## tests of a single random grouping variable
> library(glmmADMB)
Loading required package: MASS
> 
> ## random-intercept model
> set.seed(101)
> nblock <- 10
> nrep <- 10
> d <- expand.grid(f=factor(LETTERS[1:nblock]),rep=1:nrep)
> N <- nrow(d)
> d$x <- runif(N)
> u <- rnorm(nblock,sd=1)
> beta <- c(1,2)
> eta <- model.matrix(~x,data=d) %*% beta + u[as.numeric(d$f)]
> d$y <- rpois(N,exp(eta))
> 
> (g1 <- glmmadmb(y~x+(1|f),family="poisson",data=d))
Estimated covariance matrix may not be positive definite
 3.44101e-06 0.00460996 0.00520421 0.00597877 0.0134931 0.0146207 0.0177714 0.0229482 0.0329013 0.036711 0.12668 0.487471 9.92599

GLMM's in R powered by AD Model Builder:

  Family: poisson 

Fixed effects:
  Log-likelihood: -260.508 
  AIC: 527.016 
  Formula: y ~ x + (1 | f) 
(Intercept)           x 
     1.0205      1.9001 

Number of Observations: 100 
Number of Groups: 10 
> summary(g1)

Call:
glmmadmb(formula = y ~ x + (1 | f), data = d, family = "poisson")


Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)    1.020      0.309    3.31  0.00095 ***
x              1.900      0.118   16.08  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Number of observations: total=100, =10 
Random effect variance(s):
$f
            (Intercept)
(Intercept)     0.88148


Log-likelihood: -260.508 
> 
> library(lme4)
Loading required package: Matrix
Loading required package: lattice

Attaching package: 'Matrix'

The following object(s) are masked from 'package:base':

    det


Attaching package: 'lme4'

The following object(s) are masked from 'package:glmmADMB':

    VarCorr

The following object(s) are masked from 'package:stats':

    AIC, BIC

> m1 <- glmer(y~x+(1|f),family="poisson",data=d)
> r1 <- unname(unlist(ranef(g1)))
> r2 <- unname(unlist(ranef(m1)))
> ## ranef() returns DATA FRAME so need additional unwrapping
> plot(r1,r2,xlab="glmmADMB random effects",ylab="glmer random effects")
> abline(a=0,b=1)
> 
> stopifnot(all.equal(fixef(g1),fixef(m1),tolerance=1e-6))
> stopifnot(all.equal(r1,r2,tolerance=2e-4))
> 
> ## random intercepts and slopes
> set.seed(101)
> nblock <- 10
> nrep <- 10
> d2 <- expand.grid(f=factor(LETTERS[1:nblock]),rep=1:nrep)
> N <- nrow(d2)
> d2$x <- runif(N)
> u_f <- rnorm(nblock,sd=1)
> u_fx <- rnorm(nblock,sd=0.5)
> beta <- c(1,2)
> eta <- model.matrix(~x,data=d2) %*% beta + u[as.numeric(d2$f)]+
+   u[as.numeric(d2$f)]*d2$x
> d2$y <- rpois(N,exp(eta))
> 
> (g2 <- glmmadmb(y~x+(x|f),family="poisson",data=d2))
Estimated covariance matrix may not be positive definite
 1.52251e-06 2.94675e-05 0.00176421 0.00220669 0.00373328 0.00969372 0.0126432 0.0138972 0.0230209 0.0388233 0.0424115 0.0600662 0.0886014 0.150765 0.228057 0.239065 0.318752 0.40054 0.457594 0.575974 0.662924 0.722771 1.80229 13.8247

GLMM's in R powered by AD Model Builder:

  Family: poisson 

Fixed effects:
  Log-likelihood: -262.661 
  AIC: 533.322 
  Formula: y ~ x + (x | f) 
(Intercept)           x 
    0.88575     2.10750 

Number of Observations: 100 
Number of Groups: 10 
> summary(g2)

Call:
glmmadmb(formula = y ~ x + (x | f), data = d2, family = "poisson")


Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)    0.886      0.357    2.48    0.013 *  
x              2.107      0.352    5.98  2.2e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Number of observations: total=100, =10 
Random effect variance(s):
$f
            (Intercept)       x
(Intercept)      1.0235 0.00000
x                0.0000 0.78178


Log-likelihood: -262.661 
> m2 <- glmer(y~x+(1|f)+(0+x|f),family="poisson",data=d2)
> r1 <- unname(unlist(ranef(g2)))
> r2 <- unname(unlist(ranef(m2)))
> 
> stopifnot(all.equal(fixef(g2),fixef(m2),tolerance=1e-4))
> stopifnot(all.equal(r1,r2,tolerance=1.5e-3))
> 
> epil2$subject <- factor(epil2$subject)
> (fm <- glmmadmb(y~Base*trt+Age+Visit+(Visit|subject),
+                  data=epil2, family="nbinom"))

GLMM's in R powered by AD Model Builder:

  Family: nbinom 
  alpha = 7.4702 
  link = log 

Fixed effects:
  Log-likelihood: -624.551 
  AIC: 1267.102 
  Formula: y ~ Base * trt + Age + Visit + (Visit | subject) 
      (Intercept)              Base      trtprogabide               Age 
         -1.33000           0.88392          -0.92997           0.47514 
            Visit Base:trtprogabide 
         -0.27016           0.33724 

Number of Observations: 236 
Number of Groups: 59 
> summary(fm)

Call:
glmmadmb(formula = y ~ Base * trt + Age + Visit + (Visit | subject), 
    data = epil2, family = "nbinom")


Coefficients:
                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)         -1.330      1.179   -1.13    0.259    
Base                 0.884      0.131    6.76  1.4e-11 ***
trtprogabide        -0.930      0.399   -2.33    0.020 *  
Age                  0.475      0.346    1.37    0.170    
Visit               -0.270      0.167   -1.62    0.105    
Base:trtprogabide    0.337      0.203    1.66    0.096 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Number of observations: total=236, =59 
Random effect variance(s):
$subject
            (Intercept)      Visit
(Intercept)     0.21717 0.0000e+00
Visit           0.00000 2.1286e-08

Negative binomial dispersion parameter: 7.4702 (std. err.: 1.7605)

Log-likelihood: -624.551 
> 
> proc.time()
   user  system elapsed 
 17.500   1.480  19.979 
